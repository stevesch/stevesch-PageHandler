!function a(o,r,i){function c(t,e){if(!r[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);throw(n=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",n}n=r[t]={exports:{}},o[t][0].call(n.exports,function(e){return c(o[t][1][e]||e)},n,n.exports,a,o,r,i)}return r[t].exports}for(var s="function"==typeof require&&require,e=0;e<i.length;e++)c(i[e]);return c}({1:[function(e,t,n){"use strict";!function(){document.addEventListener("DOMContentLoaded",function(){function a(e,t){var n;o&&(e=JSON.stringify({set:(n=t,(t=e)in(e={})?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e)}),o.send(e))}function r(){a(this.dataset.varname,this.checked?"1":"0")}function i(){this.checked&&a(this.dataset.varname,this.value)}function c(){var e,t,n;this.dataset.varname?a(this.dataset.varname,e=""===(e=this.value)||void 0===e?1:e):this.dataset.getapi&&(e=this.dataset.getapi,t=this.dataset.target,(n=new XMLHttpRequest).open("GET",e,!0),t&&(n.onload="document"===t?function(){document.open(),document.write(n.responseText),document.close()}:function(){var e=document.getElementById(t);e&&(e.innerHTML=n.responseText)}),n.send())}function s(){a(this.dataset.varname,this.value),this.dataset.clear&&(this.value="")}window.reflections||(window.reflections=[],console.log("WARNING, PageHandler: No reflections defined on page."));var t=window.reflections;t&&1===t.length&&"%REFL_LIST%"===t[0]&&(console.log("WARNING, PageHandler: reflections not replaced by server."),t.length=0);l();document.querySelectorAll("[data-varinner]").forEach(function(e){e=e.dataset.varinner;t.includes(e)||(console.log("Unregistered var (".concat(e,") added to reflection list ")),t.push(e))}),t.forEach(function(e){var t,n,a;t=L,e="[data-varinner=".concat(n=e,"]"),a=document.querySelectorAll(e),t.addEventListener(n,function(e){d=0;var t=e.data;a.forEach(function(e){e.innerHTML=t})},!1)}),document.querySelectorAll(".watcher").forEach(function(t){var n,e=t.dataset.varname;if(t.dataset.varscript)n=new Function("event",t.dataset.varscript);else switch(t.type){case"checkbox":n=v;break;case"radio":n=h;break;default:n=f}console.log("Adding watcher for ".concat(e)),L.addEventListener(e,function(e){d=0,n.call(t,e)},!1)}),document.querySelectorAll(".sender").forEach(function(t){var n,e="change";switch(t.type){case"checkbox":n=r;break;case"radio":n=i;break;case"button":case"submit":n=c,e="click";break;default:n=s}var a=t.dataset.varname||t.dataset.getapi;console.log("Adding sender for ".concat(a));function o(e){return n.call(t,e)}t.dataset.sendtypes?(a="".concat(t.dataset.sendtypes).match(/\b(\w+)\b/g))&&a.forEach(function(e){e&&t.addEventListener(e,o)}):t.addEventListener(e,o)}),document.querySelectorAll("input[type='range'].tip").forEach(function(e){var t,n,a=document.createElement("output");a.className="bubble",e.parentElement.appendChild(a),t=e,n=a,console.log("Attaching range tip to ".concat(t.dataset.varname)),t.addEventListener("input",function(){u(t,n)}),u(t,n)}),document.querySelectorAll(".chartEl").forEach(function(e){var t,n,c,a,s,d,o,r,l,u,f,h,v,p,g,m,b,w,i,E=e.dataset.varname;function y(){i&&(clearTimeout(i),i=null),i=setTimeout(x,d)}function k(e,t){var n,a,o,r,i,n=(n=e,a=t,o=d,i=l.length-1,t=!1,(t=c?n-c<o:t)?(g=Math.min(g,a),m=Math.max(m,a),p+=a,b+=1,r=w?p/b:a,l[i]=n.getTime(),f[i]=r,u[i]=g,h[i]=m):(b=1,r=p=m=g=a,l.push(n.getTime()),f.push(r),u.push(r),h.push(r),0<=i&&(c=n)),!0);(n=function(e,t){for(var n=!1;l.length;){if(!(t<e-l[0]))break;l.shift(),f.shift(),u.shift(),h.shift(),n=!0}return n}(e,s)?!0:n)&&v.update(),y()}function x(){var e,t=f.length-1;0<=t&&(e=Date.now(),k(new Date(e),f[t]))}console.log("Adding chart for ".concat(E)),n=E,a=(t=e).getContext("2d"),s=1e3*T(t.dataset.xmax,3600),d=1e3*T(t.dataset.xinterval,5),o=T(t.dataset.ymin,0),r=T(t.dataset.ymax,255),E={labels:[],datasets:[{fill:1,backgroundColor:"rgba(128,128,220,0.2)",borderColor:"rgba(128,128,220,0.1)",pointRadius:0,pointHitRadius:0,data:[]},{label:"Data: ".concat(n),strokeColor:"rgba(0,0,0,0.75)",pointRadius:0,pointHitRadius:0,fill:!1,data:[]},{fill:1,backgroundColor:"rgba(220,128,128,0.2)",borderColor:"rgba(220,128,128,0.1)",pointRadius:0,pointHitRadius:0,data:[]}]},l=E.labels,u=(e=E.datasets)[0].data,f=e[1].data,h=e[2].data,v=new Chart(a,{type:"line",data:E,options:{legend:{display:!1},elements:{line:{tension:.1}},animation:{},scales:{xAxes:[{gridLines:{drawOnChartArea:!1,drawTicks:!1},ticks:{display:!1}}],yAxes:[{gridLines:{drawTicks:!1},ticks:{display:!1,min:o,max:r}}]}}}),b=m=g=p=0,w=t.dataset.average,i=null,L.addEventListener(n,function(e){var t=Date.now(),e=parseInt(e.data,10);k(new Date(t),e)},!1)});setInterval(function(){2<(d+=1)&&(window.db||(console.log("No communication from server for ".concat(4e3*d*.001," seconds")),3<d&&(d=0)))},4e3),function(){var e=new XMLHttpRequest;e.addEventListener("load",p,!1),e.open("GET","/api/getall",!0),e.send()}()},!1);var o,L=new EventTarget,d=0;function t(e){e.split(";").forEach(function(t){t=t.split(",");try{var e=atob(t[0]),n=atob(t[1]),a=new MessageEvent(e,{data:n});L.dispatchEvent(a)}catch(e){console.warn("Malformed message",t[0],t[1])}})}var n=3e3;function l(){var e="ws://".concat(window.location.hostname,"/").concat("ws");console.log("Opening socket at ".concat(e)),(o=new WebSocket(e)).onopen=function(){console.log("WebSocket connection opened.");var e=JSON.stringify({subscribe:["sensor1","sensor2"]});o.send(e)},o.onmessage=function(e){t(e.data)},o.onclose=function(){console.log("WebSocket connection closed. Attempting to reconnect..."),setTimeout(l,n)},o.onerror=function(e){console.log("WebSocket error:",e),o.close()}}function T(e,t){return void 0!==e?parseFloat(e):t}var a=["0","false","undefined","null",""];function u(e,t){var n=e.value,a=e.min||0,e=e.max||100,a=Number(100*(n-a)/(e-a));t.innerHTML=n,t.style.left="calc(".concat(50+.72*(a-50),"%)")}function f(e){this.value=e.data}function h(e){this.checked=e.data==this.value}function v(e){this.checked=0!=(e=e.data)&&!a.includes(String(e))}function p(e){t(e.currentTarget.response)}}()},{}]},{},[1]);